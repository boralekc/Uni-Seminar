# docker-compose for BrowserUse runner on WebMall
# Keep it minimal and compatible with Docker Compose v2 (no 'version:' key)
services:
  browseragent:
    image: browseruse:local
    build:
      context: .
      dockerfile: ./docker/BrowserUse.Dockerfile
    env_file: ./.env
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      FRONTEND_URL: ${FRONTEND_URL}
      SHOP1_URL: ${SHOP1_URL}
      SHOP2_URL: ${SHOP2_URL}
      SHOP3_URL: ${SHOP3_URL}
      SHOP4_URL: ${SHOP4_URL}

      TASKSET_PATH: /data/tasksets.json
      RESULTS_DIR: /results

    shm_size: "2gb"
    ulimits:
      memlock: -1
      nofile: 65535

    volumes:
      - ./runner/run_browseruse_webmall_study.py:/app/runner/run_browseruse_webmall_study.py:ro
      - ${TASKSET_HOST_PATH_USE:-./tasksets/subset_30_tasks.json}:/data/tasksets.json:ro
      - ${RESULTS_DIR:-./results}:/results

    working_dir: /app/runner

    command: bash -lc "python /app/runner/run_browseruse_webmall_study.py"

    networks:
      - default
      - webmall_external

networks:
  webmall_external:
    external: true
    name: ${NETWORK:-webmall-local_webmall}
